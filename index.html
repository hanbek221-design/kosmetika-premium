<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>Beauty Store ‚Äî Kosmetika Do‚Äòkoni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#050816;
      --bg-soft:#0b1021;
      --accent:#ff3e92;
      --accent-soft:#ff8bd0;
      --accent-2:#ffb800;
      --text:#f9fafb;
      --muted:#9ca3af;
      --card:#111827;
      --border-soft:rgba(148,163,184,0.4);
      --danger:#ef4444;
    }
    body.theme-light{
      --bg:#f3f4f6;
      --bg-soft:#e5e7eb;
      --accent:#ec4899;
      --accent-soft:#f9a8d4;
      --accent-2:#f97316;
      --text:#020617;
      --muted:#4b5563;
      --card:#ffffff;
      --border-soft:rgba(148,163,184,0.8);
      --danger:#dc2626;
    }

    body{
      font-family:"Poppins",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e1b4b 0,var(--bg) 45%,var(--bg) 100%);
      color:var(--text);
      min-height:100vh;
      padding-bottom:110px;
    }
    a{text-decoration:none;color:inherit}
    .hidden{display:none!important;}

    /* HEADER */
    .header{
      position:sticky;top:0;z-index:30;
      backdrop-filter:blur(18px);
      background:linear-gradient(90deg,rgba(15,23,42,0.96),rgba(24,24,27,0.9));
      border-bottom:1px solid var(--border-soft);
      padding:8px 10px 4px;
    }
    body.theme-light .header{
      background:linear-gradient(90deg,rgba(249,250,251,0.96),rgba(229,231,235,0.96));
    }
    .header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .logo-wrap{
      display:flex;align-items:center;gap:8px;
    }
    .logo-circle{
      width:32px;height:32px;border-radius:999px;
      background:conic-gradient(from 140deg,#fb7185,#f97316,#ede9fe,#38bdf8,#fb7185);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 18px rgba(248,113,113,0.6);
      font-size:18px;
    }
    .logo-circle span{
      background:#020617;
      padding:2px 7px;
      border-radius:999px;
      font-weight:700;
      font-size:13px;
      color:#f9fafb;
    }
    body.theme-light .logo-circle span{
      background:#f9fafb;
      color:#111827;
    }
    .logo-text{
      display:flex;flex-direction:column;
      line-height:1.1;
    }
    .logo-text strong{font-size:14px;}
    .logo-text small{font-size:10px;color:var(--muted);}
    .header-right{
      display:flex;align-items:center;gap:6px;
    }

    .theme-toggle{
      border:none;
      border-radius:999px;
      padding:5px 8px;
      font-size:14px;
      cursor:pointer;
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      display:flex;align-items:center;gap:4px;
    }
    body.theme-light .theme-toggle{
      background:#e5e7eb;
      color:#111827;
    }

    .cart-icon-btn{
      border:none;
      border-radius:999px;
      padding:5px 8px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      background:radial-gradient(circle at top,#22c55e,#16a34a 50%,#14532d);
      color:#022c22;
      box-shadow:0 6px 16px rgba(34,197,94,0.55);
      font-size:12px;
    }
    .cart-icon-left{
      font-size:18px;
    }
    .cart-icon-info{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.1;
    }
    .cart-icon-info strong{
      font-size:12px;
    }
    .cart-icon-info small{
      font-size:10px;
      opacity:.9;
    }

    .admin-access{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
      font-size:10px;
      padding:5px 8px;
      cursor:pointer;
    }
    body.theme-light .admin-access{
      background:#e5e7eb;
      color:#111827;
    }
    .admin-access.admin-active{
      border-color:#22c55e;
      box-shadow:0 0 10px rgba(34,197,94,0.7);
    }

    /* TABS */
    .tabs{
      display:flex;
      gap:6px;
      margin-top:6px;
      font-size:11px;
    }
    .tab-btn{
      flex:1;
      border:none;
      border-radius:999px;
      padding:5px 0;
      cursor:pointer;
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.5);
    }
    body.theme-light .tab-btn{
      background:#e5e7eb;
      color:#111827;
      border-color:rgba(148,163,184,0.8);
    }
    .tab-btn.active{
      background:linear-gradient(120deg,#f97316,#ec4899);
      color:#020617;
      border-color:transparent;
      font-weight:600;
      box-shadow:0 0 14px rgba(248,113,113,0.5);
    }

    /* HERO (shop) */
    .hero{
      padding:10px 12px 4px;
    }
    .hero-title{
      font-size:19px;
      font-weight:700;
    }
    .hero-title span{
      background:linear-gradient(120deg,#f97316,#fb7185,#e879f9);
      -webkit-background-clip:text;
      color:transparent;
    }
    .hero-sub{
      margin-top:4px;
      font-size:11px;
      color:var(--muted);
    }
    .hero-badges{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .badge{
      font-size:9px;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      background:rgba(15,23,42,0.9);
      display:flex;align-items:center;gap:4px;
      color:#e5e7eb;
    }
    body.theme-light .badge{
      background:#ffffff;
      color:#111827;
    }
    .hero-tag{
      font-size:10px;
      margin-top:8px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      background:linear-gradient(90deg,rgba(56,189,248,0.25),rgba(129,140,248,0.15));
      border:1px solid rgba(59,130,246,0.55);
    }
    .hero-note{
      margin-top:6px;
      font-size:10px;
      color:var(--muted);
    }

    /* FILTERS */
    .filters{
      padding:8px 12px 4px;
      display:flex;
      gap:8px;
      overflow-x:auto;
      scrollbar-width:none;
    }
    .filters::-webkit-scrollbar{display:none;}
    .chip{
      flex:0 0 auto;
      font-size:10px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      display:flex;align-items:center;gap:5px;
      cursor:pointer;
      transition:0.18s ease;
      white-space:nowrap;
    }
    body.theme-light .chip{
      background:#ffffff;
      color:#111827;
    }
    .chip.active{
      background:linear-gradient(120deg,#f97316,#ec4899);
      border-color:transparent;
      color:#0f172a;
      font-weight:600;
      box-shadow:0 0 14px rgba(248,113,113,0.4);
    }

    /* PRODUCT GRID */
    .products-wrap{
      padding:6px 8px 80px;
    }
    .products-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:480px){
      .products-grid{
        grid-template-columns:1fr;
      }
    }
    @media(min-width:768px){
      .products-grid{
        grid-template-columns:repeat(3,minmax(0,1fr));
      }
      body{padding-bottom:110px;}
    }
    .product-card{
      background:linear-gradient(145deg,#020617,var(--card));
      border-radius:16px;
      border:1px solid rgba(31,41,55,0.9);
      padding:8px;
      position:relative;
      overflow:hidden;
      box-shadow:0 10px 22px rgba(0,0,0,0.55);
    }
    body.theme-light .product-card{
      background:#ffffff;
      border-color:rgba(209,213,219,0.9);
      box-shadow:0 10px 24px rgba(148,163,184,0.65);
    }
    .product-top{
      position:relative;
      border-radius:14px;
      padding:6px;
      background:radial-gradient(circle at top,#1d4ed8,#020617 55%);
      overflow:hidden;
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }
    body.theme-light .product-top{
      background:radial-gradient(circle at top,#bfdbfe,#e5e7eb 55%);
    }
    .product-photo{
      width:80px;height:80px;
      border-radius:12px;
      overflow:hidden;
      flex-shrink:0;
      border:1px solid rgba(148,163,184,0.7);
    }
    @media(max-width:480px){
      .product-photo{
        width:100px;height:100px;
      }
    }
    .product-photo img{
      width:100%;height:100%;object-fit:cover;
      display:block;
    }
    .product-emoji{
      font-size:26px;
      margin-left:auto;
    }
    .product-img-tag{
      position:absolute;
      left:6px;top:6px;
      font-size:8px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.7);
      display:flex;align-items:center;gap:4px;
      color:#e5e7eb;
    }
    body.theme-light .product-img-tag{
      background:#ffffff;
      color:#111827;
    }
    .product-sale{
      position:absolute;
      right:-22px;
      bottom:6px;
      background:linear-gradient(120deg,#f97316,#ec4899);
      padding:2px 24px;
      transform:rotate(14deg);
      font-size:9px;
      font-weight:700;
      color:#111827;
    }
    .product-body{
      margin-top:6px;
    }
    .product-name{
      font-size:12px;
      font-weight:600;
      min-height:32px;
    }
    .product-meta{
      font-size:9px;
      color:var(--muted);
      margin-top:1px;
    }
    .tag-mini{
      font-size:8px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(55,65,81,0.9);
      margin-top:4px;
      display:inline-flex;
      align-items:center;
      gap:4px;
      color:#e5e7eb;
    }
    body.theme-light .tag-mini{
      background:#f9fafb;
      border-color:rgba(209,213,219,0.9);
      color:#111827;
    }
    .price-row{
      margin-top:6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      font-size:11px;
    }
    .price-main{
      font-weight:700;
    }
    .price-old{
      font-size:9px;
      color:var(--muted);
      text-decoration:line-through;
    }
    .btn-add{
      border:none;
      border-radius:999px;
      padding:6px 9px;
      font-size:10px;
      font-weight:600;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:4px;
      box-shadow:0 6px 12px rgba(34,197,94,0.35);
      flex-shrink:0;
    }
    .btn-add:active{transform:scale(.96);}

    /* BOTTOM ORDER BAR ‚Äì PREMIUM STYLE, WEBAPP UCHUN BIROZ YUQORIDA */
    .cart-bar{
      position:fixed;
      left:10px;
      right:10px;
      bottom:24px; /* WebApp pastki panelidan yuqoriroqda */
      background:linear-gradient(
        135deg,
        rgba(15,23,42,0.96),
        rgba(24,24,27,0.9)
      );
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.65);
      padding:8px 12px 10px;
      z-index:25;
      box-shadow:
        0 18px 40px rgba(0,0,0,0.8),
        0 0 0 1px rgba(15,23,42,0.8);
      backdrop-filter:blur(18px);
    }
    body.theme-light .cart-bar{
      background:linear-gradient(
        135deg,
        rgba(249,250,251,0.98),
        rgba(229,231,235,0.98)
      );
      box-shadow:
        0 16px 32px rgba(148,163,184,0.7),
        0 0 0 1px rgba(209,213,219,0.8);
    }

    .cart-bar-note{
      font-size:10px;
      color:var(--muted);
      margin-bottom:5px;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .cart-bar-note::before{
      content:"‚ú®";
      font-size:11px;
    }

    /* ASOSIY BUYURTMA TUGMASI ‚Äì BRAND */
    .cart-main-btn{
      width:100%;
      border:none;
      padding:11px 12px;
      border-radius:999px;
      background:linear-gradient(120deg,#f97316,#ec4899,#8b5cf6);
      color:#020617;
      font-size:13px;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
      box-shadow:
        0 14px 32px rgba(236,72,153,0.85),
        0 0 0 1px rgba(248,250,252,0.6);
    }
    .cart-main-btn:active{
      transform:scale(.97);
    }
    .cart-main-btn > div:first-child{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.1;
    }
    .cart-main-btn > div:first-child div{
      font-size:13px;
      letter-spacing:0.02em;
      text-transform:uppercase;
    }
    .cart-main-btn span.small{
      font-size:10px;
      font-weight:500;
      opacity:.9;
    }
    .cart-main-btn > div:last-child span{
      font-size:20px;
    }

    /* CART SHEET */
    .sheet-overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.7);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
      z-index:35;
    }
    .sheet-overlay.show{
      opacity:1;
      pointer-events:auto;
    }

    .cart-sheet{
      position:fixed;
      left:0;right:0;bottom:0;
      background:radial-gradient(circle at top,#020617,var(--bg-soft));
      border-radius:22px 22px 0 0;
      border-top:1px solid rgba(148,163,184,0.7);
      max-height:75vh;
      transform:translateY(100%);
      transition:transform .25s ease;
      z-index:40;
      display:flex;
      flex-direction:column;
      box-shadow:0 -24px 36px rgba(0,0,0,0.9);
    }
    body.theme-light .cart-sheet{
      background:radial-gradient(circle at top,#f9fafb,#e5e7eb);
      box-shadow:0 -18px 30px rgba(148,163,184,0.8);
    }
    .cart-sheet.open{
      transform:translateY(0);
    }
    .cart-sheet-header{
      padding:10px 14px 8px;
      border-bottom:1px solid var(--border-soft);
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
    }
    .cart-sheet-header h3{
      font-size:13px;
      font-weight:600;
      letter-spacing:0.04em;
      text-transform:uppercase;
    }
    .cart-sheet-header button{
      border:none;
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
      width:26px;height:26px;
      border-radius:999px;
      cursor:pointer;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    body.theme-light .cart-sheet-header button{
      background:#e5e7eb;
      color:#111827;
    }
    .cart-sheet-body{
      padding:6px 14px 4px;
      overflow-y:auto;
      max-height:48vh;
    }
    .cart-sheet-footer{
      padding:8px 14px 12px;
      border-top:1px solid var(--border-soft);
      font-size:12px;
      background:linear-gradient(
        135deg,
        rgba(15,23,42,0.96),
        rgba(30,64,175,0.9)
      );
      color:#e5e7eb;
      border-radius:0 0 22px 22px;
    }
    body.theme-light .cart-sheet-footer{
      background:linear-gradient(
        135deg,
        rgba(249,250,251,0.98),
        rgba(219,234,254,0.98)
      );
      color:#111827;
    }
    .cart-sheet-footer-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .cart-sheet-footer-top span{
      font-size:11px;
      opacity:.9;
    }
    .cart-sheet-footer-top strong{
      font-size:14px;
    }
    .cart-edit-label{
      color:var(--danger);
      font-size:10px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:4px;
      margin-bottom:4px;
    }
    .cart-sheet-btn{
      width:100%;
      border:none;
      border-radius:999px;
      padding:10px 10px;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      box-shadow:
        0 12px 28px rgba(34,197,94,0.65),
        0 0 0 1px rgba(240,253,250,0.8);
      letter-spacing:0.02em;
      text-transform:uppercase;
    }
    .cart-sheet-btn:active{
      transform:scale(.97);
    }

    .cart-empty{
      font-size:11px;
      color:var(--muted);
      text-align:center;
      padding:12px 0;
    }

    .cart-item-row{
      padding:7px 0;
      border-bottom:1px dashed rgba(75,85,99,0.6);
      display:flex;
      flex-direction:column;
      gap:5px;
      font-size:11px;
    }
    .cart-item-main{
      display:flex;
      flex-direction:column;
      gap:1px;
    }
    .cart-item-name{
      font-weight:600;
    }
    .cart-item-meta{
      font-size:10px;
      color:var(--muted);
    }
    .cart-item-actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      font-size:10px;
    }
    .qty-control{
      display:flex;
      align-items:center;
      border-radius:999px;
      border:1px solid rgba(75,85,99,0.9);
      overflow:hidden;
    }
    .qty-control button{
      border:none;
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
      width:22px;height:20px;
      cursor:pointer;
      font-size:13px;
    }
    body.theme-light .qty-control button{
      background:#e5e7eb;
      color:#111827;
    }
    .qty-control span{
      padding:0 7px;
      min-width:20px;
      text-align:center;
      font-size:11px;
    }
    .cart-item-total{
      font-weight:600;
    }
    .cart-remove{
      border:none;
      background:transparent;
      color:var(--danger);
      cursor:pointer;
      font-size:16px;
    }

    /* TOAST */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:95px;
      background:rgba(15,23,42,0.98);
      border-radius:999px;
      padding:6px 12px;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      border:1px solid rgba(52,211,153,0.7);
      box-shadow:0 8px 20px rgba(22,163,74,0.75);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease,transform .2s ease;
      z-index:50;
    }
    .toast.show{
      opacity:1;
      transform:translate(-50%, -2px);
      pointer-events:auto;
    }

    /* HISTORY PAGE */
    .page{
      padding:10px 12px 80px;
    }
    .page-title{
      font-size:15px;
      font-weight:600;
      margin-bottom:4px;
    }
    .page-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
    }
    .history-empty{
      font-size:11px;
      color:var(--muted);
      padding:16px 0;
      text-align:center;
    }
    .order-card{
      background:var(--card);
      border-radius:12px;
      border:1px solid var(--border-soft);
      padding:8px 10px;
      margin-bottom:8px;
      font-size:11px;
      box-shadow:0 6px 16px rgba(0,0,0,0.5);
    }
    body.theme-light .order-card{
      background:#ffffff;
      box-shadow:0 6px 14px rgba(148,163,184,0.6);
    }
    .order-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }
    .order-head strong{
      font-size:12px;
    }
    .order-meta{
      font-size:10px;
      color:var(--muted);
      margin-bottom:4px;
    }
    .order-items{
      margin-top:4px;
      padding-left:10px;
    }
    .order-items li{
      margin-bottom:2px;
    }

    .clear-history-btn{
      border:none;
      background:transparent;
      color:var(--danger);
      font-size:11px;
      text-decoration:underline;
      cursor:pointer;
      margin-bottom:6px;
    }

    /* ADMIN PAGE */
    .admin-form{
      background:var(--card);
      border-radius:12px;
      border:1px solid var(--border-soft);
      padding:8px 10px;
      font-size:11px;
      margin-bottom:10px;
    }
    body.theme-light .admin-form{
      background:#ffffff;
      box-shadow:0 6px 14px rgba(148,163,184,0.4);
    }
    .admin-form h3{
      font-size:13px;
      margin-bottom:6px;
    }
    .form-row{
      margin-bottom:6px;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .form-row label{
      font-size:10px;
      color:var(--muted);
    }
    .form-row input,
    .form-row select{
      border-radius:8px;
      border:1px solid rgba(148,163,184,0.7);
      padding:5px 7px;
      font-size:11px;
      background:rgba(15,23,42,0.7);
      color:#f9fafb;
    }
    body.theme-light .form-row input,
    body.theme-light .form-row select{
      background:#f9fafb;
      color:#111827;
    }
    .admin-check-row{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:10px;
      margin:4px 0 2px;
      color:var(--muted);
    }
    .admin-btn{
      border:none;
      border-radius:999px;
      padding:7px 9px;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      font-size:11px;
      font-weight:600;
      cursor:pointer;
      margin-top:4px;
    }
    .admin-info{
      font-size:10px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .admin-list-title{
      font-size:12px;
      margin:6px 0 4px;
      font-weight:600;
    }
    .admin-product-row{
      font-size:11px;
      padding:5px 0;
      border-bottom:1px dashed rgba(75,85,99,0.6);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .admin-product-row span{
      flex:1;
    }
    .admin-delete-btn{
      border:none;
      background:transparent;
      color:var(--danger);
      cursor:pointer;
      font-size:16px;
    }

    /* IMAGE VIEWER (full screen gallery) */
    .image-viewer{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.96);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:60;
    }
    .image-viewer-inner{
      position:relative;
      max-width:100%;
      max-height:100%;
      padding:40px 16px 22px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }
    .image-viewer-title{
      font-size:12px;
      text-align:center;
      max-width:90%;
    }
    .image-viewer-img-wrap{
      position:relative;
      max-width:100%;
      max-height:70vh;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .image-viewer-img-wrap img{
      max-width:100%;
      max-height:70vh;
      object-fit:contain;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.8);
      background:#020617;
    }
    .image-viewer-close{
      position:absolute;
      top:10px;right:16px;
      border:none;
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      border-radius:999px;
      width:32px;height:32px;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      font-size:16px;
    }
    .image-viewer-arrow{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      border:none;
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
      width:32px;height:32px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      font-size:18px;
    }
    .image-viewer-arrow.left{left:10px;}
    .image-viewer-arrow.right{right:10px;}
    .image-viewer-counter{
      font-size:11px;
      color:#9ca3af;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-row">
      <div class="logo-wrap">
        <div class="logo-circle">
          <span>B</span>
        </div>
        <div class="logo-text">
          <strong>Beauty Store</strong>
          <small>Premium kosmetika do‚Äòkoni</small>
        </div>
      </div>
      <div class="header-right">
        <button class="theme-toggle" id="themeToggleBtn" type="button">üåô</button>

        <button class="cart-icon-btn" type="button" onclick="toggleCartSheet(true)">
          <span class="cart-icon-left">üõí</span>
          <div class="cart-icon-info">
            <strong><span id="cartCountTop">0</span> ta</strong>
            <small id="cartTotalTop">0 so‚Äòm</small>
          </div>
        </button>

        <!-- Admin uchun kirish tugmasi -->
        <button id="adminAccessBtn" class="admin-access" type="button">
          üëë Admin uchun
        </button>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs" id="tabs">
      <button class="tab-btn active" data-page="shopPage">Do‚Äòkon</button>
      <button class="tab-btn" data-page="historyPage">Buyurtmalar tarixi</button>
      <button class="tab-btn hidden" data-page="adminPage" id="adminTabBtn">Admin panel</button>
    </div>
  </header>

  <!-- SHOP PAGE -->
  <div id="shopPage">
    <section class="hero">
      <div class="hero-title">
        Har kuni <span>go‚Äòzallik</span> kayfiyati üí´
      </div>
      <p class="hero-sub">
        Pomada, krem, parfyum, niqob va yana ko‚Äòplab mahsulotlar ‚Äî hammasi bitta joyda.
      </p>
      <div class="hero-badges">
        <div class="badge">‚≠ê Original sifat</div>
        <div class="badge">üî• Eng ko‚Äòp sotilganlar</div>
        <div class="badge">üíå Telegram orqali buyurtma</div>
      </div>
      <div class="hero-tag">
        ‚ú® Buyurtmalar <strong>@onatili_premium</strong> ga chiroyli formatda boradi
      </div>
      <div class="hero-note">
        Buyurtma yuborilgandan keyin faqat telefon raqamingizni yozib qoldiring ‚Äî
        admin sizga tez orada qo‚Äòng‚Äòiroq qiladi.
      </div>
    </section>

    <!-- FILTERS -->
    <div class="filters" id="filterBar">
      <button class="chip active" data-category="all">‚≠ê Barchasi</button>
      <button class="chip" data-category="pomada">üíÑ Pomada</button>
      <button class="chip" data-category="krem">üß¥ Kremlar</button>
      <button class="chip" data-category="parfyum">üå∏ Parfyum</button>
      <button class="chip" data-category="niqob">üò∑ Niqob / Mask</button>
      <button class="chip" data-category="ko‚Äòz">üëÅ Ko‚Äòz uchun</button>
      <button class="chip" data-category="tana">üõÅ Tana parvarishi</button>
    </div>

    <!-- PRODUCTS -->
    <main class="products-wrap">
      <div class="products-grid" id="productsGrid"></div>
    </main>
  </div>

  <!-- HISTORY PAGE -->
  <div id="historyPage" class="page hidden">
    <div class="page-title">üìú Buyurtmalar tarixi</div>
    <p class="page-sub">
      Bu yerda shu qurilmadan yuborilgan buyurtmalaringiz ro‚Äòyxati saqlanadi
      (faqat shu brauzer / telefon uchun).
    </p>
    <button class="clear-history-btn" type="button" onclick="clearHistory()">
      Tarixni tozalash
    </button>
    <div id="historyList"></div>
  </div>

  <!-- ADMIN PAGE -->
  <div id="adminPage" class="page hidden">
    <div class="page-title">üõ† Admin panel</div>
    <p class="page-sub">
      Bu sahifa faqat admin uchun. Mahsulotlar localStorage‚Äôda saqlanadi (shu qurilmada).
    </p>

    <div class="admin-form">
      <h3>Yangi mahsulot qo‚Äòshish</h3>
      <div class="form-row">
        <label>Mahsulot nomi</label>
        <input id="adminName" placeholder="Masalan: Luxury Lipstick Pink" />
      </div>
      <div class="form-row">
        <label>Kategoriya</label>
        <select id="adminCategory">
          <option value="pomada">Pomada / lab uchun</option>
          <option value="krem">Krem / yuz uchun</option>
          <option value="parfyum">Parfyum</option>
          <option value="niqob">Niqob / mask</option>
          <option value="ko‚Äòz">Ko‚Äòz uchun</option>
          <option value="tana">Tana / soch parvarishi</option>
        </select>
      </div>
      <div class="form-row">
        <label>Asosiy narx (chegirmadan oldin), so‚Äòm</label>
        <input id="adminPriceBase" type="number" min="0" placeholder="Masalan: 119000" />
      </div>
      <div class="admin-check-row">
        <input id="adminHasDiscount" type="checkbox" />
        <span>Chegirma bor (yangi narxni kiriting)</span>
      </div>
      <div class="form-row">
        <label>Chegirma narxi (agar belgilangan bo‚Äòlsa), so‚Äòm</label>
        <input id="adminPriceDiscount" type="number" min="0" placeholder="Masalan: 99000" />
      </div>
      <div class="form-row">
        <label>Qisqa tavsiya / tag (ixtiyoriy)</label>
        <input id="adminTag" placeholder="Masalan: Kundalik foydalanish uchun" />
      </div>
      <div class="form-row">
        <label>Rasm URL manzillari (vergul bilan ajratib yozing)</label>
        <input id="adminImages" placeholder="https://..., https://..., https://..." />
      </div>
      <button class="admin-btn" type="button" onclick="addCustomProduct()">
        ‚ûï Mahsulotni qo‚Äòshish
      </button>
      <p class="admin-info">
        Eslatma: qo‚Äòshilgan mahsulotlar va admin holati faqat shu qurilmada eslab qolinadi.
      </p>
    </div>

    <div class="admin-info">
      üî¥ O‚Äòchirish faqat o‚Äòzingiz qo‚Äòshgan mahsulotlar uchun ishlaydi.
    </div>
    <div class="admin-list-title">Siz qo‚Äòshgan mahsulotlar:</div>
    <div id="adminCustomList"></div>
  </div>

  <!-- BOTTOM ORDER BAR -->
  <div class="cart-bar">
    <div class="cart-bar-note">
      Savatdagi buyurtmani tahrirlash / o‚Äòchirish uchun tepadagi üõí savat tugmasini bosing.
    </div>
    <button class="cart-main-btn" type="button" onclick="toggleCartSheet(true)">
      <div>
        <div>üì© Buyurtmani Telegramga yuborish</div>
        <span class="small">
          Istalgancha marta yuborish mumkin. Telegramda telefon raqamingizni yozib qoldiring.
        </span>
      </div>
      <div><span>‚Ä∫</span></div>
    </button>
  </div>

  <!-- CART SHEET -->
  <div class="sheet-overlay" id="cartSheetOverlay" onclick="toggleCartSheet(false)"></div>

  <div class="cart-sheet" id="cartSheet">
    <div class="cart-sheet-header">
      <h3>üõí Savatingiz</h3>
      <button type="button" onclick="toggleCartSheet(false)">‚úï</button>
    </div>
    <div class="cart-sheet-body" id="cartItems"></div>
    <div class="cart-sheet-footer">
      <div class="cart-edit-label">
        üîß Buyurtmani tahrirlash / o‚Äòchirish (qizil ‚úï tugmalar orqali)
      </div>
      <div class="cart-sheet-footer-top">
        <span>Umumiy summa:</span>
        <strong id="cartSheetTotal">0 so‚Äòm</strong>
      </div>
      <button class="cart-sheet-btn" type="button" onclick="sendOrder()">
        üì© Telegramga yuborish (@onatili_premium)
      </button>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast">
    ‚úÖ Savatga qo‚Äòshildi
  </div>

  <!-- FULLSCREEN IMAGE VIEWER -->
  <div id="imageViewer" class="image-viewer hidden">
    <div class="image-viewer-inner" onclick="event.stopPropagation()">
      <button class="image-viewer-close" onclick="closeImageViewer()">‚úï</button>
      <div class="image-viewer-title" id="imageViewerTitle"></div>
      <div class="image-viewer-img-wrap">
        <button class="image-viewer-arrow left" onclick="prevImage()">‚Äπ</button>
        <img id="imageViewerImg" src="" alt="Mahsulot rasmi">
        <button class="image-viewer-arrow right" onclick="nextImage()">‚Ä∫</button>
      </div>
      <div class="image-viewer-counter" id="imageViewerCounter"></div>
    </div>
  </div>

<script>
  // --- KONSTANTALAR ---
  const ADMIN_CODE = "12345678";
  const STORAGE_PRODUCTS = "beauty_custom_products";
  const STORAGE_HISTORY = "beauty_order_history";
  const STORAGE_ADMIN = "beauty_admin";
  const THEME_KEY = "beauty_theme";

  const categoryEmoji = {
    "pomada":"üíÑ",
    "krem":"üß¥",
    "parfyum":"üå∏",
    "niqob":"üò∑",
    "ko‚Äòz":"üëÅ",
    "tana":"üõÅ",
    "default":"üíÖ"
  };

  // --- DASTLABKI MAHSULOTLAR (har birida 1-3 ta rasm) ---
  const defaultProducts = [
    {
      name:"Mat pomada Nude Lux",
      price:89000,
      oldPrice:109000,
      category:"pomada",
      emoji:"üíÑ",
      tag:"Yangi kolleksiya",
      images:[
        "https://images.pexels.com/photos/3373744/pexels-photo-3373744.jpeg?auto=compress&cs=tinysrgb&w=400",
        "https://images.pexels.com/photos/3373738/pexels-photo-3373738.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Qizil mat pomada Classic Red",
      price:99000,
      oldPrice:119000,
      category:"pomada",
      emoji:"üíã",
      tag:"Best seller",
      images:[
        "https://images.pexels.com/photos/947301/pexels-photo-947301.jpeg?auto=compress&cs=tinysrgb&w=400",
        "https://images.pexels.com/photos/3738360/pexels-photo-3738360.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Lip gloss Shimmer Rose",
      price:76000,
      oldPrice:null,
      category:"pomada",
      emoji:"‚ú®",
      tag:"Yaltirroq effekt",
      images:[
        "https://images.pexels.com/photos/3373749/pexels-photo-3373749.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Gialuronli yuz kremi",
      price:129000,
      oldPrice:149000,
      category:"krem",
      emoji:"üß¥",
      tag:"Namlik 24 soat",
      images:[
        "https://images.pexels.com/photos/3738341/pexels-photo-3738341.jpeg?auto=compress&cs=tinysrgb&w=400",
        "https://images.pexels.com/photos/3738364/pexels-photo-3738364.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Kunduzgi SPF 50 krem",
      price:139000,
      oldPrice:159000,
      category:"krem",
      emoji:"üåû",
      tag:"SPF qo‚Äòriqlovchi",
      images:[
        "https://images.pexels.com/photos/3738342/pexels-photo-3738342.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Tungi regeneratsion krem",
      price:155000,
      oldPrice:179000,
      category:"krem",
      emoji:"üåô",
      tag:"Tungi parvarish",
      images:[
        "https://images.pexels.com/photos/3738364/pexels-photo-3738364.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Gul hidli ayollar parfyumi",
      price:199000,
      oldPrice:229000,
      category:"parfyum",
      emoji:"üå∏",
      tag:"Eng ko‚Äòp yoqadigan",
      images:[
        "https://images.pexels.com/photos/965989/pexels-photo-965989.jpeg?auto=compress&cs=tinysrgb&w=400",
        "https://images.pexels.com/photos/965991/pexels-photo-965991.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Erkaklar uchun Fresh parfyum",
      price:189000,
      oldPrice:219000,
      category:"parfyum",
      emoji:"üï∫",
      tag:"Uzoq saqlanadi",
      images:[
        "https://images.pexels.com/photos/965992/pexels-photo-965992.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Unisex Citrus parfyum",
      price:215000,
      oldPrice:249000,
      category:"parfyum",
      emoji:"üçã",
      tag:"Citrus hidi",
      images:[
        "https://images.pexels.com/photos/965990/pexels-photo-965990.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Ko‚Äòz soyasi palitrasi 16 rang",
      price:175000,
      oldPrice:199000,
      category:"ko‚Äòz",
      emoji:"üëÅ",
      tag:"Professional",
      images:[
        "https://images.pexels.com/photos/3373735/pexels-photo-3373735.jpeg?auto=compress&cs=tinysrgb&w=400",
        "https://images.pexels.com/photos/3738360/pexels-photo-3738360.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Qalam tusuvchi ko‚Äòz layner",
      price:59000,
      oldPrice:null,
      category:"ko‚Äòz",
      emoji:"‚úèÔ∏è",
      tag:"Qora klassik",
      images:[
        "https://images.pexels.com/photos/3738345/pexels-photo-3738345.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Hajm beruvchi maskara Volume+",
      price:97000,
      oldPrice:119000,
      category:"ko‚Äòz",
      emoji:"üéØ",
      tag:"Juda mashhur",
      images:[
        "https://images.pexels.com/photos/3373737/pexels-photo-3373737.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Qora maska (poralarni tozalovchi)",
      price:69000,
      oldPrice:84000,
      category:"niqob",
      emoji:"üò∑",
      tag:"Terlashga qarshi",
      images:[
        "https://images.pexels.com/photos/3738346/pexels-photo-3738346.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Namlik beruvchi mato niqob",
      price:39000,
      oldPrice:49000,
      category:"niqob",
      emoji:"üíß",
      tag:"1 dona",
      images:[
        "https://images.pexels.com/photos/3738355/pexels-photo-3738355.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Tana uchun shokolad skrab",
      price:99000,
      oldPrice:115000,
      category:"tana",
      emoji:"üç´",
      tag:"Yumshoq teri",
      images:[
        "https://images.pexels.com/photos/3738370/pexels-photo-3738370.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Dush geli Coconut Dream",
      price:67000,
      oldPrice:null,
      category:"tana",
      emoji:"üõÅ",
      tag:"Kokos hidi",
      images:[
        "https://images.pexels.com/photos/3738373/pexels-photo-3738373.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Qo‚Äòl kremi Almond Care",
      price:49000,
      oldPrice:null,
      category:"tana",
      emoji:"ü§≤",
      tag:"Quruq teri uchun",
      images:[
        "https://images.pexels.com/photos/3738375/pexels-photo-3738375.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Sochlar uchun argan yog‚Äòi",
      price:129000,
      oldPrice:145000,
      category:"tana",
      emoji:"üíÜ‚Äç‚ôÄÔ∏è",
      tag:"Sochni tiklaydi",
      images:[
        "https://images.pexels.com/photos/3738371/pexels-photo-3738371.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Make-up cho‚Äòtkalar seti 7 dona",
      price:139000,
      oldPrice:159000,
      category:"tana",
      emoji:"üñå",
      tag:"To‚Äòliq to‚Äòplam",
      images:[
        "https://images.pexels.com/photos/3738385/pexels-photo-3738385.jpeg?auto=compress&cs=tinysrgb&w=400",
        "https://images.pexels.com/photos/3738365/pexels-photo-3738365.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    },
    {
      name:"Maskara Waterproof",
      price:93000,
      oldPrice:109000,
      category:"ko‚Äòz",
      emoji:"üíß",
      tag:"Suvga chidamli",
      images:[
        "https://images.pexels.com/photos/3738367/pexels-photo-3738367.jpeg?auto=compress&cs=tinysrgb&w=400"
      ]
    }
  ];

  // --- HOLAT ---
  let customProducts = [];
  let products = [];
  let cart = [];
  let activeCategory = "all";
  let isAdmin = false;

  // Fullscreen image viewer state
  let viewerProductIndex = null;
  let viewerImageIndex = 0;

  // --- DOM ELEMENTLAR ---
  const productsGrid = document.getElementById("productsGrid");
  const filterBar = document.getElementById("filterBar");
  const cartCountTopEl = document.getElementById("cartCountTop");
  const cartTotalTopEl = document.getElementById("cartTotalTop");
  const toastEl = document.getElementById("toast");
  const cartSheet = document.getElementById("cartSheet");
  const cartSheetOverlay = document.getElementById("cartSheetOverlay");
  const cartItemsEl = document.getElementById("cartItems");
  const cartSheetTotalEl = document.getElementById("cartSheetTotal");
  const themeToggleBtn = document.getElementById("themeToggleBtn");
  const tabsEl = document.getElementById("tabs");
  const historyListEl = document.getElementById("historyList");
  const adminCustomListEl = document.getElementById("adminCustomList");
  const adminAccessBtn = document.getElementById("adminAccessBtn");
  const adminTabBtn = document.getElementById("adminTabBtn");
  const imageViewerEl = document.getElementById("imageViewer");
  const imageViewerTitleEl = document.getElementById("imageViewerTitle");
  const imageViewerImgEl = document.getElementById("imageViewerImg");
  const imageViewerCounterEl = document.getElementById("imageViewerCounter");

  // --- YORDAMCHI FUNKSIYALAR ---
  function formatPrice(v){
    return v.toLocaleString("uz-UZ");
  }

  function showToast(message){
    toastEl.textContent = message;
    toastEl.classList.add("show");
    setTimeout(()=> toastEl.classList.remove("show"), 1100);
  }

  // --- MAHSULOTLARNI YUKLASH / SAQLASH ---
  function loadCustomProducts(){
    try{
      customProducts = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS) || "[]");
    }catch(e){
      customProducts = [];
    }
  }
  function saveCustomProducts(){
    localStorage.setItem(STORAGE_PRODUCTS, JSON.stringify(customProducts));
  }
  function rebuildProducts(){
    products = [...defaultProducts, ...customProducts];
    renderProducts();
  }

  // --- MAHSULOTLARNI CHIZISH ---
  function renderProducts(){
    productsGrid.innerHTML = "";
    const filtered = products.filter(p =>
      activeCategory === "all" ? true : p.category === activeCategory
    );
    filtered.forEach(p=>{
      const index = products.indexOf(p);
      const discount = p.oldPrice ? (100 - Math.round(p.price*100/p.oldPrice)) : null;
      const tag = p.tag || "Ommabop mahsulot";
      const img = (p.images && p.images.length) ? p.images[0] : "https://via.placeholder.com/400x400.png?text=Beauty";
      productsGrid.innerHTML += `
        <article class="product-card">
          <div class="product-top" onclick="openImageViewer(${index},0)">
            <div class="product-img-tag">
              <span>Beauty</span> <span>Pro</span>
            </div>
            <div class="product-photo">
              <img src="${img}" alt="${p.name}">
            </div>
            <div class="product-emoji">${p.emoji || categoryEmoji[p.category] || categoryEmoji.default}</div>
            ${discount ? `<div class="product-sale">- ${discount}%</div>` : ``}
          </div>
          <div class="product-body">
            <div class="product-name">${p.name}</div>
            <div class="product-meta">
              ${p.category.toUpperCase()} ‚Ä¢ ${tag}
            </div>
            <div class="tag-mini">
              üí° Tavsiya: ${tag}
            </div>
            <div class="price-row">
              <div>
                <div class="price-main">${formatPrice(p.price)} so‚Äòm</div>
                ${p.oldPrice ? `<div class="price-old">${formatPrice(p.oldPrice)} so‚Äòm</div>` : ``}
              </div>
              <button class="btn-add" onclick="addToCart(${index})">
                ‚ûï Savatga
              </button>
            </div>
          </div>
        </article>
      `;
    });
  }

  // --- FILTER ---
  filterBar.addEventListener("click", (e)=>{
    const btn = e.target.closest(".chip");
    if(!btn) return;
    document.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
    btn.classList.add("active");
    activeCategory = btn.dataset.category;
    renderProducts();
  });

  // --- SAVAT FUNKSIYALARI ---
  function addToCart(index){
    const found = cart.find(c => c.index === index);
    if(found){
      found.qty += 1;
    }else{
      cart.push({index, qty:1});
    }
    updateCartUI();
    showToast("‚úÖ Savatga qo‚Äòshildi");
  }

  function updateCartUI(){
    let totalCount = 0;
    let totalPrice = 0;
    cart.forEach(c=>{
      const p = products[c.index];
      totalCount += c.qty;
      totalPrice += p.price * c.qty;
    });
    cartCountTopEl.textContent = totalCount;
    cartTotalTopEl.textContent = formatPrice(totalPrice) + " so‚Äòm";

    if(cartSheet.classList.contains("open")){
      renderCartItems();
    }
  }

  function toggleCartSheet(force){
    const isOpen = cartSheet.classList.contains("open");
    const next = typeof force === "boolean" ? force : !isOpen;
    cartSheet.classList.toggle("open", next);
    cartSheetOverlay.classList.toggle("show", next);
    if(next){
      renderCartItems();
    }
  }

  function renderCartItems(){
    if(cart.length === 0){
      cartItemsEl.innerHTML = "<p class='cart-empty'>Savat hozircha bo‚Äòsh üôÇ</p>";
      cartSheetTotalEl.textContent = "0 so‚Äòm";
      return;
    }
    let html = "";
    let total = 0;
    cart.forEach(c=>{
      const p = products[c.index];
      const lineTotal = p.price * c.qty;
      total += lineTotal;
      html += `
        <div class="cart-item-row">
          <div class="cart-item-main">
            <div class="cart-item-name">${p.name}</div>
            <div class="cart-item-meta">
              ${formatPrice(p.price)} so‚Äòm ‚Ä¢ ${p.category.toUpperCase()}
            </div>
          </div>
          <div class="cart-item-actions">
            <div class="qty-control">
              <button onclick="changeQty(${c.index}, -1)">-</button>
              <span>${c.qty}</span>
              <button onclick="changeQty(${c.index}, 1)">+</button>
            </div>
            <div class="cart-item-total">${formatPrice(lineTotal)} so‚Äòm</div>
            <button class="cart-remove" onclick="removeFromCart(${c.index})">‚úï</button>
          </div>
        </div>
      `;
    });
    cartItemsEl.innerHTML = html;
    cartSheetTotalEl.textContent = formatPrice(total) + " so‚Äòm";
  }

  function changeQty(productIndex, delta){
    const item = cart.find(c => c.index === productIndex);
    if(!item) return;
    item.qty += delta;
    if(item.qty <= 0){
      cart = cart.filter(c=>c.index !== productIndex);
    }
    updateCartUI();
    renderCartItems();
  }

  function removeFromCart(productIndex){
    cart = cart.filter(c=>c.index !== productIndex);
    updateCartUI();
    renderCartItems();
  }

  // --- TELEGRAM WEBAPP LINK ---
  function openTelegramLink(url){
    const tg = window.Telegram && window.Telegram.WebApp;
    if(tg){
      tg.openTelegramLink(url);  // WebApp ichida
    }else{
      window.open(url, "_blank"); // brauzerda yangi tab
    }
  }

  // --- BUYURTMA TARIXI ---
  function saveOrderHistory(order){
    let list = [];
    try{
      list = JSON.parse(localStorage.getItem(STORAGE_HISTORY) || "[]");
    }catch(e){}
    list.unshift(order);
    localStorage.setItem(STORAGE_HISTORY, JSON.stringify(list));
    renderHistory();
  }

  function renderHistory(){
    let list = [];
    try{
      list = JSON.parse(localStorage.getItem(STORAGE_HISTORY) || "[]");
    }catch(e){}
    if(!list.length){
      historyListEl.innerHTML = "<p class='history-empty'>Hozircha buyurtmalar tarixi bo‚Äòsh.</p>";
      return;
    }
    historyListEl.innerHTML = "";
    list.forEach((order, idx)=>{
      const date = new Date(order.date);
      const dateStr = date.toLocaleString("uz-UZ");
      let itemsHtml = "";
      order.items.forEach(it=>{
        itemsHtml += `<li>${it.line}</li>`;
      });
      historyListEl.innerHTML += `
        <div class="order-card">
          <div class="order-head">
            <strong>Buyurtma #${list.length - idx}</strong>
            <span>${order.totalFormatted}</span>
          </div>
          <div class="order-meta">
            üìÖ ${dateStr} ‚Ä¢ üß∫ ${order.totalItems} ta mahsulot
          </div>
          <div>Mahsulotlar:</div>
          <ul class="order-items">
            ${itemsHtml}
          </ul>
        </div>
      `;
    });
  }

  function clearHistory(){
    if(confirm("Buyurtmalar tarixini tozalashni xohlaysizmi?")){
      localStorage.removeItem(STORAGE_HISTORY);
      renderHistory();
    }
  }

  // --- TELEGRAMGA BUYURTMA JO'NATISH (EMOJI + CHIROYLI MATN) ---
  function sendOrder(){
    if(cart.length === 0){
      showToast("Savat bo‚Äòsh. Avval mahsulot tanlang üôÇ");
      return;
    }

    let totalPrice = 0;
    let totalItems = 0;
    let lines = [];

    cart.forEach((c, i)=>{
      const p = products[c.index];
      const lineTotal = p.price * c.qty;
      totalPrice += lineTotal;
      totalItems += c.qty;
      const catEmoji = categoryEmoji[p.category] || p.emoji || categoryEmoji.default;
      const lineText =
        `${i+1}) ${catEmoji} ${p.name} ‚Äî ${c.qty} dona √ó ${formatPrice(p.price)} so‚Äòm = ${formatPrice(lineTotal)} so‚Äòm`;
      lines.push({line: lineText, product: p});
    });

    const totalStr = formatPrice(totalPrice);

    let text = "";
    text += "üíñ BEAUTY STORE ‚Äî Onlayn buyurtma\n";
    text += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
    text += "üß∫ Savatimdagi mahsulotlar:\n\n";
    lines.forEach(l=>{
      text += "‚Ä¢ " + l.line + "\n";
    });
    text += "\nüí∞ Umumiy summa: " + totalStr + " so‚Äòm\n";
    text += "üì¶ Buyurtma turi: Kosmetika mahsulotlari\n";
    text += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
    text += "üì± Faqat telefon raqamimni yozib qoldiraman,\n";
    text += "admin menga tez orada qo‚Äòng‚Äòiroq qiladi.\n";
    text += "üìç Manzilim: _______\n";

    const encoded = encodeURIComponent(text);
    const url = "https://t.me/onatili_premium?text=" + encoded + "&t=" + Date.now();

    const order = {
      date: new Date().toISOString(),
      totalPrice: totalPrice,
      totalFormatted: totalStr + " so‚Äòm",
      totalItems: totalItems,
      items: lines
    };
    saveOrderHistory(order);

    openTelegramLink(url);
    showToast("‚úÖ Buyurtma yuborildi. Telegramda telefon raqamingizni yozib qoldiring.");
  }

  // --- TEMA (DARK / LIGHT) ---
  function applyTheme(theme){
    document.body.classList.toggle("theme-light", theme === "light");
    themeToggleBtn.textContent = theme === "light" ? "üåô" : "‚òÄÔ∏è";
  }
  function toggleTheme(){
    const current = localStorage.getItem(THEME_KEY) || "dark";
    const next = current === "dark" ? "light" : "dark";
    localStorage.setItem(THEME_KEY, next);
    applyTheme(next);
  }
  themeToggleBtn.addEventListener("click", toggleTheme);

  // --- TABS ---
  tabsEl.addEventListener("click", (e)=>{
    const btn = e.target.closest(".tab-btn");
    if(!btn) return;

    const pageId = btn.dataset.page;
    if(pageId === "adminPage" && !isAdmin){
      showToast("üëë Avval admin kodini kiriting.");
      return;
    }

    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    document.getElementById("shopPage").classList.add("hidden");
    document.getElementById("historyPage").classList.add("hidden");
    document.getElementById("adminPage").classList.add("hidden");
    document.getElementById(pageId).classList.remove("hidden");

    if(pageId === "historyPage"){
      renderHistory();
    }else if(pageId === "adminPage"){
      renderAdminCustomList();
    }
  });

  // --- ADMIN LOGIN ---
  function updateAdminUI(){
    if(isAdmin){
      adminTabBtn.classList.remove("hidden");
      adminAccessBtn.classList.add("admin-active");
      adminAccessBtn.textContent = "üëë Admin (kirdingiz)";
    }else{
      adminTabBtn.classList.add("hidden");
      adminAccessBtn.classList.remove("admin-active");
      adminAccessBtn.textContent = "üëë Admin uchun";
    }
  }

  function askAdminCode(){
    if(isAdmin){
      // allaqachon admin: admin tabga o‚Äòtkazamiz
      document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
      adminTabBtn.classList.add("active");
      document.getElementById("shopPage").classList.add("hidden");
      document.getElementById("historyPage").classList.add("hidden");
      document.getElementById("adminPage").classList.remove("hidden");
      renderAdminCustomList();
      return;
    }
    const code = prompt("Admin uchun kirish kodi:");
    if(code === null) return;
    if(code === ADMIN_CODE){
      isAdmin = true;
      localStorage.setItem(STORAGE_ADMIN, "true");
      updateAdminUI();
      showToast("‚úÖ Admin sifatida kirdingiz");
    }else{
      showToast("‚ùå Noto‚Äòg‚Äòri kod");
    }
  }

  adminAccessBtn.addEventListener("click", askAdminCode);

  // --- ADMIN CUSTOM MAHSULOTLAR ---
  function addCustomProduct(){
    const nameEl = document.getElementById("adminName");
    const catEl = document.getElementById("adminCategory");
    const baseEl = document.getElementById("adminPriceBase");
    const hasDiscountEl = document.getElementById("adminHasDiscount");
    const discEl = document.getElementById("adminPriceDiscount");
    const tagEl = document.getElementById("adminTag");
    const imgsEl = document.getElementById("adminImages");

    const name = nameEl.value.trim();
    const category = catEl.value;
    const basePrice = parseInt(baseEl.value, 10);
    const hasDiscount = hasDiscountEl.checked;
    const discountPriceRaw = discEl.value ? parseInt(discEl.value, 10) : null;
    const tag = tagEl.value.trim();

    if(!name || !basePrice || basePrice <= 0){
      alert("Mahsulot nomi va asosiy narxini to‚Äòg‚Äòri kiriting.");
      return;
    }

    let price = basePrice;
    let oldPrice = null;
    if(hasDiscount && discountPriceRaw && discountPriceRaw > 0 && discountPriceRaw < basePrice){
      price = discountPriceRaw;
      oldPrice = basePrice;
    }

    let images = [];
    const raw = imgsEl.value.trim();
    if(raw){
      images = raw.split(",").map(s=>s.trim()).filter(Boolean);
    }
    if(!images.length){
      images = ["https://via.placeholder.com/400x400.png?text=Beauty"];
    }

    const emoji = categoryEmoji[category] || categoryEmoji.default;

    const product = {
      name,
      price,
      oldPrice,
      category,
      emoji,
      tag,
      images,
      custom:true,
      id: Date.now()
    };

    customProducts.push(product);
    saveCustomProducts();
    rebuildProducts();
    renderAdminCustomList();

    nameEl.value = "";
    baseEl.value = "";
    discEl.value = "";
    hasDiscountEl.checked = false;
    tagEl.value = "";
    imgsEl.value = "";

    showToast("‚úÖ Mahsulot qo‚Äòshildi");
  }

  function renderAdminCustomList(){
    if(!customProducts.length){
      adminCustomListEl.innerHTML = "<p class='history-empty'>Hali qo‚Äòshilgan mahsulot yo‚Äòq.</p>";
      return;
    }
    adminCustomListEl.innerHTML = "";
    customProducts.forEach(p=>{
      adminCustomListEl.innerHTML += `
        <div class="admin-product-row">
          <span>${p.name}</span>
          <span>${formatPrice(p.price)} so‚Äòm</span>
          <button class="admin-delete-btn" onclick="deleteCustomProduct(${p.id})">‚úï</button>
        </div>
      `;
    });
  }

  function deleteCustomProduct(id){
    if(!confirm("Bu mahsulotni o‚Äòchirishni xohlaysizmi?")) return;
    customProducts = customProducts.filter(p => p.id !== id);
    saveCustomProducts();
    rebuildProducts();
    renderAdminCustomList();
    showToast("üóë Mahsulot o‚Äòchirildi");
  }

  // --- FULLSCREEN IMAGE VIEWER ---
  function openImageViewer(productIndex, imageIndex){
    const p = products[productIndex];
    if(!p || !p.images || !p.images.length) return;
    viewerProductIndex = productIndex;
    viewerImageIndex = imageIndex || 0;
    updateImageViewer();
    imageViewerEl.classList.remove("hidden");
  }

  function updateImageViewer(){
    const p = products[viewerProductIndex];
    if(!p || !p.images || !p.images.length) return;
    const imgs = p.images;
    if(viewerImageIndex < 0) viewerImageIndex = imgs.length - 1;
    if(viewerImageIndex >= imgs.length) viewerImageIndex = 0;
    const url = imgs[viewerImageIndex];

    imageViewerImgEl.src = url;
    imageViewerTitleEl.textContent = p.name;
    imageViewerCounterEl.textContent = (viewerImageIndex+1) + " / " + imgs.length;
  }

  function closeImageViewer(){
    imageViewerEl.classList.add("hidden");
  }

  function nextImage(){
    viewerImageIndex++;
    updateImageViewer();
  }

  function prevImage(){
    viewerImageIndex--;
    updateImageViewer();
  }

  // overlayga bosilganda ham yopilsin
  imageViewerEl.addEventListener("click", function(){
    closeImageViewer();
  });

  // ESC bosilganda yopish
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      if(!imageViewerEl.classList.contains("hidden")){
        closeImageViewer();
      }
    }
  });

  // --- INIT ---
  (function init(){
    const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
    applyTheme(savedTheme);

    // admin holatini yuklash
    isAdmin = localStorage.getItem(STORAGE_ADMIN) === "true";
    updateAdminUI();

    loadCustomProducts();
    rebuildProducts();
    renderHistory();
  })();

  // global funksiyalar
  window.addToCart = addToCart;
  window.toggleCartSheet = toggleCartSheet;
  window.changeQty = changeQty;
  window.removeFromCart = removeFromCart;
  window.sendOrder = sendOrder;
  window.addCustomProduct = addCustomProduct;
  window.deleteCustomProduct = deleteCustomProduct;
  window.clearHistory = clearHistory;
  window.openImageViewer = openImageViewer;
  window.closeImageViewer = closeImageViewer;
  window.nextImage = nextImage;
  window.prevImage = prevImage;
</script>

</body>
</html>
